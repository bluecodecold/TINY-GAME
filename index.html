<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>2048 手机可滑动版</title>
<style>
html,body{margin:0;height:100%;display:flex;align-items:center;justify-content:center;
          background:#faf8ef;font-family:Arial,Helvetica,sans-serif;color:#776e65;overflow:hidden;}
h1{margin:0 0 10px;font-size:60px;font-weight:700;letter-spacing:-.04em;}
.score-board{display:flex;justify-content:space-between;width:340px;margin-bottom:10px;font-size:22px;font-weight:700;}
.score,.best{background:#bbada0;padding:5px 15px;border-radius:3px;color:#fff;min-width:60px;text-align:center;}
#grid-container{width:340px;height:340px;background:#bbada0;border-radius:6px;
                display:grid;grid-template-columns:repeat(4,1fr);grid-gap:10px;padding:10px;box-sizing:border-box;touch-action:none;}
.tile{border-radius:3px;font-size:35px;font-weight:700;display:flex;align-items:center;justify-content:center;}
.tile-0{background:#cdc1b4;}
.tile-2{background:#eee4da;}
.tile-4{background:#ede0c8;}
.tile-8{background:#f2b179;color:#f9f6f2;}
.tile-16{background:#f59563;color:#f9f6f2;}
.tile-32{background:#f67c5f;color:#f9f6f2;}
.tile-64{background:#f65e3b;color:#f9f6f2;}
.tile-128{background:#edcf72;color:#f9f6f2;font-size:30px;}
.tile-256{background:#edcc61;color:#f9f6f2;font-size:30px;}
.tile-512{background:#edc850;color:#f9f6f2;font-size:30px;}
.tile-1024{background:#edc53f;color:#f9f6f2;font-size:25px;}
.tile-2048{background:#edc22e;color:#f9f6f2;font-size:25px;}
.btn{background:#8f7a66;border:none;border-radius:3px;color:#fff;padding:8px 16px;font-size:18px;cursor:pointer;}
.btn:hover{background:#9f8a76;}
#game-over{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
           background:rgba(238,228,218,.9);padding:20px 30px;border-radius:10px;font-size:28px;display:none;}
#game-over button{margin-top:10px;}
</style>
</head>
<body>
<div>
    <h1>2048</h1>
    <div class="score-board">
        <div>分数：<span id="score">0</span></div>
        <div class="best">最佳：<span id="best">0</span></div>
    </div>
    <div id="grid-container"></div>
    <button class="btn" onclick="initGame()">重新开始</button>
</div>

<div id="game-over">
    <div id="over-text">游戏结束！</div>
    <button class="btn" onclick="initGame()">再来一次</button>
</div>

<script>
const SIZE = 4;
let board, score, best = localStorage.best ? +localStorage.best : 0;

function initGame() {
    board = Array.from({length: SIZE}, () => Array(SIZE).fill(0));
    score = 0;
    addTile();
    addTile();
    updateUI();
    document.getElementById('game-over').style.display = 'none';
}

function addTile() {
    const empties = [];
    for (let r = 0; r < SIZE; r++)
        for (let c = 0; c < SIZE; c++)
            if (!board[r][c]) empties.push({r, c});
    if (!empties.length) return;
    const {r, c} = empties[Math.floor(Math.random() * empties.length)];
    board[r][c] = Math.random() < 0.9 ? 2 : 4;
}

function updateUI() {
    const container = document.getElementById('grid-container');
    container.innerHTML = '';
    for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
            const num = board[r][c];
            const div = document.createElement('div');
            div.className = 'tile tile-' + num;
            div.textContent = num || '';
            container.appendChild(div);
        }
    }
    document.getElementById('score').textContent = score;
    document.getElementById('best').textContent = best;
}

function move(dir) {
    const dr = [-1,0,1,0];
    const dc = [0,1,0,-1];
    const moved = JSON.parse(JSON.stringify(board));
    let movedFlag = false;
    const order = Array.from({length: SIZE}, (_,i)=>i);
    if (dir === 1 || dir === 2) order.reverse();

    for (let r of order) {
        for (let c of order) {
            let i = dir % 2 ? c : r;
            let j = dir % 2 ? r : c;
            if (!moved[i][j]) continue;
            let curR = i, curC = j;
            let nr = curR + dr[dir];
            let nc = curC + dc[dir];
            while (true) {
                if (nr < 0 || nc < 0 || nr >= SIZE || nc >= SIZE) break;
                if (moved[nr][nc] === 0) {
                    moved[nr][nc] = moved[curR][curC];
                    moved[curR][curC] = 0;
                    curR = nr; curC = nc;
                    movedFlag = true;
                    nr += dr[dir]; nc += dc[dir];
                } else if (moved[nr][nc] === moved[curR][curC]) {
                    moved[nr][nc] *= 2;
                    score += moved[nr][nc];
                    moved[curR][curC] = 0;
                    movedFlag = true;
                    break;
                } else break;
            }
        }
    }

    if (movedFlag) {
        board = moved;
        addTile();
        updateUI();
        if (score > best) { best = score; localStorage.best = best; }
        if (isGameOver()) {
            document.getElementById('over-text').textContent = score >= 2048 ? '恭喜达成 2048！' : '游戏结束！';
            document.getElementById('game-over').style.display = 'block';
        }
    }
}

function isGameOver() {
    for (let r = 0; r < SIZE; r++)
        for (let c = 0; c < SIZE; c++) {
            if (!board[r][c]) return false;
            if (r < SIZE-1 && board[r][c] === board[r+1][c]) return false;
            if (c < SIZE-1 && board[r][c] === board[r][c+1]) return false;
        }
    return true;
}

/* 键盘 */
document.addEventListener('keydown', e=>{
    switch(e.key){
        case 'ArrowUp': move(0); break;
        case 'ArrowRight': move(1); break;
        case 'ArrowDown': move(2); break;
        case 'ArrowLeft': move(3); break;
    }
});

/* 触屏滑动 */
let touchStartX = 0, touchStartY = 0;
const container = document.getElementById('grid-container');
container.addEventListener('touchstart', e=>{
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
});
container.addEventListener('touchend', e=>{
    const dx = e.changedTouches[0].clientX - touchStartX;
    const dy = e.changedTouches[0].clientY - touchStartY;
    const absDx = Math.abs(dx), absDy = Math.abs(dy);
    if (Math.max(absDx, absDy) < 30) return;
    if (absDx > absDy) {
        dx > 0 ? move(1) : move(3);
    } else {
        dy > 0 ? move(2) : move(0);
    }
});

initGame();
</script>
</body>
</html>